/**
    @name: aping-plugin-wikipedia 
    @version: 0.5.0 (20-06-2016) 
    @author: Jonathan Hornung 
    @url: https://github.com/JohnnyTheTank/apiNG-plugin-wikipedia 
    @license: MIT
*/
"use strict";angular.module("jtt_aping_wikipedia",["jtt_wikipedia"]).directive("apingWikipedia",["apingWikipediaHelper","apingUtilityHelper","wikipediaFactory",function(a,b,c){return{require:"?aping",restrict:"A",replace:"false",link:function(d,e,f,g){var h=g.getAppSettings(),i=b.parseJsonFromAttributes(f.apingWikipedia,a.getThisPlatformString(),h);i.forEach(function(b){var d={model:h.model};angular.isDefined(h.getNativeData)?d.getNativeData=h.getNativeData:d.getNativeData=!1;var e={pithumbsize:700};return angular.isDefined(b.items)?e.gsrlimit=b.items:e.gsrlimit=h.items,0===e.gsrlimit||"0"===e.gsrlimit?!1:((e.gsrlimit<0||isNaN(e.gsrlimit))&&(e.gsrlimit=void 0),e.gsrlimit>500&&(e.gsrlimit=500),angular.isDefined(b.language)&&(e.lang=b.language),void(angular.isDefined(b.title)?(e.term=b.title,c.getArticle(e).then(function(b){b&&g.concatToResults(a.getObjectByJsonData(b,d))})):angular.isDefined(b.search)&&(e.term=b.search,!angular.isDefined(b.textSearch)||"true"!==b.textSearch&&b.textSearch!==!0?c.searchArticlesByTitle(e).then(function(b){b&&g.concatToResults(a.getObjectByJsonData(b,d))}):c.searchArticles(e).then(function(b){b&&g.concatToResults(a.getObjectByJsonData(b,d))}))))})}}}]),angular.module("jtt_aping_wikipedia").service("apingWikipediaHelper",["apingModels","apingTimeHelper","apingUtilityHelper",function(a,b,c){this.getThisPlatformString=function(){return"wikipedia"},this.getThisPlatformLink=function(a){return"https://"+a+".wikipedia.org/wiki/"},this.getObjectByJsonData=function(a,b){var c=[];if(a&&a.data&&a.data.query&&a.data.query.pages){var d=this;a.data.query.pages&&angular.forEach(a.data.query.pages,function(a,e){var f;f=b.getNativeData===!0||"true"===b.getNativeData?a:d.getItemByJsonData(a,b.model),f&&c.push(f)})}return c},this.getItemByJsonData=function(a,b){var c={};if(a&&b)switch(b){case"social":c=this.getSocialItemByJsonData(a);break;default:return!1}return c},this.getSocialItemByJsonData=function(d){var e=a.getNew("social",this.getThisPlatformString());return angular.extend(e,{timestamp:b.getTimestampFromDateString(d.touched,1e3,36e5),post_url:d.pagelanguage?this.getThisPlatformLink(d.pagelanguage)+encodeURI(d.title):void 0,intern_id:d.pageid,text:c.getTextFromHtml(d.extract),caption:d.title,img_url:d.thumbnail?d.thumbnail.source:void 0,thumb_url:d.thumbnail?d.thumbnail.source:void 0,native_url:d.thumbnail?d.thumbnail.source:void 0,source:d.extract,position:d.index}),e.date_time=new Date(e.timestamp),e}}]),angular.module("jtt_wikipedia",[]).factory("wikipediaFactory",["$http","wikipediaSearchDataService",function(a,b){var c={};return c.searchArticlesByTitle=function(c){var d=b.getNew("searchArticlesByTitle",c);return a.jsonp(d.url,{method:"GET",params:d.object})},c.searchArticles=function(c){var d=b.getNew("searchArticles",c);return a.jsonp(d.url,{method:"GET",params:d.object})},c.getArticle=function(c){var d=b.getNew("getArticle",c);return a.jsonp(d.url,{method:"GET",params:d.object})},c}]).service("wikipediaSearchDataService",function(){this.getApiBaseUrl=function(a){return"https://"+a+".wikipedia.org/w/api.php"},this.fillDataInObjectByList=function(a,b,c){return angular.forEach(c,function(c,d){angular.isDefined(b[c])&&(a.object[c]=b[c])}),a},this.getNew=function(a,b){var c={object:{callback:"JSON_CALLBACK",action:"query",format:"json",formatversion:2},url:""};switch(angular.isUndefined(b.lang)&&(b.lang="en"),angular.isUndefined(b.pithumbsize)&&(b.pithumbsize="400"),a){case"searchArticlesByTitle":c.object.prop="extracts|pageimages|info",c.object.generator="search",c.object.gsrsearch="intitle:"+b.term,c.object.pilimit="max",c.object.exlimit="max",c.object.exintro="",c=this.fillDataInObjectByList(c,b,["prop","generator","gsrsearch","pilimit","exlimit","exintro","rvparse","formatversion","prop","pithumbsize","gsrlimit"]),c.url=this.getApiBaseUrl(b.lang);break;case"searchArticles":c.object.prop="extracts|pageimages|info",c.object.generator="search",c.object.gsrsearch=b.term,c.object.pilimit="max",c.object.exlimit="max",c.object.exintro="",c=this.fillDataInObjectByList(c,b,["prop","generator","gsrsearch","pilimit","exlimit","exintro","rvparse","formatversion","prop","pithumbsize","gsrlimit"]),c.url=this.getApiBaseUrl(b.lang);break;case"getArticle":c.object.prop="extracts|pageimages|images|info",c.object.titles=b.term,c=this.fillDataInObjectByList(c,b,["prop","rvparse","formatversion","prop","pithumbsize"]),c.url=this.getApiBaseUrl(b.lang)}return c}});